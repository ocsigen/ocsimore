<html><head><title>Module Ocsi_sql </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/></head><body class="Ocsi_sql dev"><h1>Module <span><a href=".././api/Ocsi_sql">Ocsi_sql</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Ocsi_sql</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Ocsi_sql">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Database interface to the Ocsimore database.
</p><hr/><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Ocsi_sql.Lwt_PGOCaml">Lwt_PGOCaml</a></span> <span class="ocsforge_color_delimiter">:</span> <br/>  <span class="odocwiki_type"><span class="ocsforge_color_uid">PGOCaml_generic.PGOCAML_GENERIC</span></span><span class="odocwiki_type"><br/>  with type 'a monad = 'a Lwt.t</span></pre><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Ocsi_sql.Lwt_Query">Lwt_Query</a></span> <span class="ocsforge_color_delimiter">:</span> <br/>  <span class="odocwiki_type"><span class="ocsforge_color_uid">Query.QUERY</span></span><span class="odocwiki_type"><br/>  with type 'a Db.t = 'a Lwt_PGOCaml.t and type 'a Db.monad = 'a Lwt.t</span></pre><pre class="ocsforge_color odocwiki_code" id="TYPEdb_t"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">db_t</span> <span class="ocsforge_color_delimiter">=</span> <span class="odocwiki_type"><span class="ocsforge_color_uid">Lwt_PGOCaml</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">pa_pg_data</span> <span class="ocsforge_color_uid">Lwt_PGOCaml</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALpool"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">pool</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsi_sql#TYPEdb_t">db_t</a></span> <span class="ocsforge_color_uid">Lwt_pool</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALtransaction_block"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">transaction_block</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Ocsi_sql#TYPEdb_t">db_t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Perform an atomic transaction (using BEGIN and COMMIT/ROLLBACK</p></div><pre class="ocsforge_color odocwiki_code" id="VALfull_transaction_block"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">full_transaction_block</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span><span><a href=".././api/Ocsi_sql#TYPEdb_t">db_t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Same as <span class="odocwiki_inlinecode">transaction_block</span> but takes a db connection in the pool.</p></div><pre class="ocsforge_color odocwiki_code" id="VALview"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">view</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'a, 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">view</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALview_one"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">view_one</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'a, 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">view</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALview_opt"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">view_opt</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>'a, 'b<span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">view</span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a option <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALquery"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">query</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">query</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><pre class="ocsforge_color odocwiki_code" id="VALvalue"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">value</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  &lt; nul : <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">non_nullable</span>; t : 'a #<span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">type_info</span>; .. &gt; <span class="ocsforge_color_uid">Sql</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  'a <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre></body></html>
