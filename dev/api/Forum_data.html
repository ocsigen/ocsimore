<html><head><title>Module Forum_data </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/></head><body class="Forum_data dev"><h1>Module <span><a href=".././api/Forum_data">Forum_data</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Forum_data</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Forum_data">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p><strong>Author(s):</strong> Vincent Balat, Boris Yakobowski<br/>
</p><hr/><h2 id="2_Databaseaccesswithverificationofpermissions">Database access with verification of permissions <a class="backref" href="#2_Databaseaccesswithverificationofpermissions">&#182;</a></h2><pre class="ocsforge_color odocwiki_code" id="VALnew_forum"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">new_forum</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">title:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">descr:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?arborescent:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">title_syntax:</span><span class="ocsforge_color_uid">Html5_types</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">phrasing</span> <span class="ocsforge_color_uid">Eliom_content</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">Html5</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_uid">F</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">elt</span> list<br/>               <span><a href=".././api/Wiki_types#TYPEcontent_type">Wiki_types.content_type</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">messages_wiki:</span><span><a href=".././api/Wiki_types#TYPEwiki">Wiki_types.wiki</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">comments_wiki:</span><span><a href=".././api/Wiki_types#TYPEwiki">Wiki_types.wiki</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEforum">Forum_types.forum</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>create a new forum. <span class="odocwiki_inlinecode">?arborescent</span> is true by default.
Setting it to false will prevent to comment comments.
May fail with exception <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALupdate_forum"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">update_forum</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">?title:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?descr:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?arborescent:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?title_syntax:</span>'res <span><a href=".././api/Wiki_types#TYPEcontent_type">Wiki_types.content_type</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?messages_wiki:</span><span><a href=".././api/Wiki_types#TYPEwiki">Wiki_types.wiki</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?comments_wiki:</span><span><a href=".././api/Wiki_types#TYPEwiki">Wiki_types.wiki</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEforum">Forum_types.forum</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Update the information of a forum. All arguments not passed are left
unchanged. May fail with exception
<span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALnew_message"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">new_message</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">forum:</span><span><a href=".././api/Forum_types#TYPEforum">Forum_types.forum</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">creator_id:</span><span><a href=".././api/User_sql.Types#TYPEuserid">User_sql.Types.userid</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?subject:</span>string <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">?parent_id:</span><span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">text:</span>string <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>inserts a message in a forum.
<span class="odocwiki_inlinecode">?moderated</span> is false by default.
May fail with exception <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALset_moderated"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">set_moderated</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">message_id:</span><span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span class="ocsforge_color_label">moderated:</span>bool <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>set or unset moderated flag on a message.
May fail with exception <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_forum"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_forum</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">forum:</span><span><a href=".././api/Forum_types#TYPEforum">Forum_types.forum</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEforum_info">Forum_types.forum_info</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>Get forum information, given its id or title.
May fail with exception <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_forums_list"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_forums_list</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEforum_info">Forum_types.forum_info</a></span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>returns the list of forums visible to the user.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_message"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_message</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">message_id:</span><span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEmessage_info">Forum_types.message_info</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>returns id, subject, author, datetime, parent id, root id, forum id, text,
and moderated, deleted status of a message.
May fail with exception <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_thread"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_thread</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">message_id:</span><span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEmessage_info">Forum_types.message_info</a></span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>returns a list of messages containing the message of id <span class="odocwiki_inlinecode">~message_id</span>
and all its children, ordered according depth first traversal of the tree.
Deleted messages are returned.
Only readable messages comments are returned.
Comments of unreadable messages are not returned.
May fail with exceptions <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span>
or <span class="odocwiki_inlinecode">Not_found</span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALget_childs"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_childs</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">message_id:</span><span><a href=".././api/Forum_types#TYPEmessage">Forum_types.message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEmessage_info">Forum_types.message_info</a></span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>returns a list of all the direct childs of messages <span class="odocwiki_inlinecode">~message_id</span>.
Only readable messages comments are returned.</p></div><pre class="ocsforge_color odocwiki_code" id="TYPEraw_message"><span class="ocsforge_color_keyword">type</span> <span class="odocwiki_name">raw_message</span></pre><pre class="ocsforge_color odocwiki_code" id="VALget_message_list"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">get_message_list</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span class="ocsforge_color_label">forum:</span><span><a href=".././api/Forum_types#TYPEforum">Forum_types.forum</a></span> <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">first:</span>int64 <span class="ocsforge_color_delimiter">-&gt;</span><br/>  <span class="ocsforge_color_label">number:</span>int64 <span class="ocsforge_color_delimiter">-&gt;</span> unit <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_data#TYPEraw_message">raw_message</a></span> list <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>returns the list of messages (without comments) in a forum.
If the user cannot read unmoderated messages,
only moderated messages and messages with special rights
(must be filtered afterwards!!!) are returned.</p></div><pre class="ocsforge_color odocwiki_code" id="VALmessage_info_of_raw_message"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">message_info_of_raw_message</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><br/>  <span><a href=".././api/Forum_data#TYPEraw_message">raw_message</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> <span><a href=".././api/Forum_types#TYPEmessage_info">Forum_types.message_info</a></span> <span class="ocsforge_color_uid">Lwt</span><span class="ocsforge_color_delimiter">.</span><span class="ocsforge_color_lid">t</span></span></pre><div class="odocwiki_info"><p>translate <span class="odocwiki_inlinecode">raw_message</span> to <span class="odocwiki_inlinecode">Forum_types.forum_info</span>,
verifying special rights if needed (only for first messages).
Raises <span class="odocwiki_inlinecode">Ocsimore_common.Permission_denied</span> if special rights do not
allow to read the message.</p></div></body></html>
