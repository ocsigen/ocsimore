=Module <<a_api_type | module Forum_data >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Forum_data>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Forum_data >><<span class="ocsforge_color_keyword"|end>>>>**Author(s):** Vincent Balat, Boris Yakobowski\\

----


==@@id="2_Databaseaccesswithverificationofpermissions"@@~Database access with verification of permissions==

<<pre id="VALnew_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|new~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| title: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| descr: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?arborescent: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| title_syntax: >><<span class="ocsforge_color_uid"|Html5_types>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|phrasing>> <<span class="ocsforge_color_uid"|Eliom_content>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|Html5>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_uid"|F>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|elt>> list\\               <<a_api text="Wiki_types.content_type" | type Wiki_types.content_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| messages_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| comments_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|create a new forum~. <<span class="odocwiki_inlinecode"|~?arborescent>> is true by default~.
    ~Setting it to false will prevent to comment comments~.
    ~May fail with exception <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALupdate_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?title: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?descr: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?arborescent: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?title_syntax: >>'res <<a_api text="Wiki_types.content_type" | type Wiki_types.content_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?messages_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?comments_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Update the information of a forum~. ~All arguments not passed are left
    unchanged~. ~May fail with exception
    <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALnew_message" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|new~_message>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| creator_id: >><<a_api text="User_sql.Types.userid" | type User_sql.Types.userid >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?subject: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?parent_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| text: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|inserts a message in a forum~.
    <<span class="odocwiki_inlinecode"|~?moderated>> is false by default~.
    ~May fail with exception <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALset_moderated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_moderated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| moderated: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|set or unset moderated flag on a message~.
    ~May fail with exception <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALget_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum_info" | type Forum_types.forum_info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Get forum information~, given its id or title~.
    ~May fail with exception <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALget_forums_list" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forums~_list>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum_info" | type Forum_types.forum_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns the list of forums visible to the user~.
>>
<<pre id="VALget_message" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_message>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns id~, subject~, author~, datetime~, parent id~, root id~, forum id~, text~,
    and moderated~, deleted status of a message~.
    ~May fail with exception <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>~.
>>
<<pre id="VALget_thread" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_thread>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns a list of messages containing the message of id <<span class="odocwiki_inlinecode"|~~message~_id>>
    and all its children~, ordered according depth first traversal of the tree~.
    ~Deleted messages are returned~.
    ~Only readable messages comments are returned~.
    ~Comments of unreadable messages are not returned~.
    ~May fail with exceptions <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>>
    or <<span class="odocwiki_inlinecode"|~Not~_found>>~.
>>
<<pre id="VALget_childs" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_childs>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns a list of all the direct childs of messages <<span class="odocwiki_inlinecode"|~~message~_id>>~.
    ~Only readable messages comments are returned~.
>>
<<pre class="ocsforge_color odocwiki_code" id="TYPEraw_message"|<<span class="ocsforge_color_keyword"|type>> <<span class="odocwiki_name"|raw~_message>>>><<pre id="VALget_message_list" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_message~_list>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| first: >>int64 <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| number: >>int64 <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="raw_message" | type Forum_data.raw_message >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns the list of messages ~(without comments~) in a forum~.
    ~If the user cannot read unmoderated messages~,
    only moderated messages and messages with special rights
    ~(must be filtered afterwards!!!~) are returned~.
>>
<<pre id="VALmessage_info_of_raw_message" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|message~_info~_of~_raw~_message>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<a_api text="raw_message" | type Forum_data.raw_message >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|translate <<span class="odocwiki_inlinecode"|raw~_message>> to <<span class="odocwiki_inlinecode"|~Forum~_types~.forum~_info>>~,
    verifying special rights if needed ~(only for first messages~)~.
    ~Raises <<span class="odocwiki_inlinecode"|~Ocsimore~_common~.~Permission~_denied>> if special rights do not
    allow to read the message~.
>>
