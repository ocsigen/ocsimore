=Module <<a_api_type | module Forum_sql >> =
<<pre class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|module>> <<span class="ocsforge_color_uid"|<<span class="ocsforge_color_uid"|Forum_sql>>>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="ocsforge_color_keyword"|sig>><<a_api text=".." | module Forum_sql >><<span class="ocsforge_color_keyword"|end>>>>**Author(s):** Piero Furiesi, Jaap Boender, Vincent Balat, Boris Yakobowski\\

----
<<pre id="VALnew_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|new~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| title: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| descr: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?arborescent: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| title_syntax: >>'res <<a_api text="Wiki_types.content_type" | type Wiki_types.content_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| messages_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| comments_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|create a new forum~. <<span class="odocwiki_inlinecode"|~?arborescent>> is true by default~.
    ~Setting it to false will prevent to comment comments~.
>>
<<pre id="VALupdate_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|update~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?title: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?descr: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?arborescent: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?title_syntax: >>'res <<a_api text="Wiki_types.content_type" | type Wiki_types.content_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?messages_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?comments_wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Update the information of a forum~. ~All arguments not passed are left
    unchanged
>>
<<pre id="VALnew_message" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|new~_message>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| wiki: >><<a_api text="Wiki_types.wiki" | type Wiki_types.wiki >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| creator_id: >><<a_api text="User_sql.Types.userid" | type User_sql.Types.userid >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| title_syntax: >>'res <<a_api text="Wiki_types.content_type" | type Wiki_types.content_type >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?subject: >>string <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?parent_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| ?moderated: >>bool <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| text: >>string <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|inserts a message in a forum~.
    <<span class="odocwiki_inlinecode"|~?moderated>> is false by default~.
>>
<<pre id="VALset_moderated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|set~_moderated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >> <<span class="ocsforge_color_label"| moderated: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|set or unset moderated flag on a message
>>
<<pre id="VALget_forum" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forum>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?not_deleted_only: >>bool <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum_info" | type Forum_types.forum_info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Get forum information~, given its id or title~.
    ~Information is~: ~(forum id~, title~, description~, arborescent~, deleted~)
>>
<<pre id="VALforum_exists" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|forum~_exists>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| title: >>string <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|~Return if a forum title is already used
>>
<<pre id="VALget_forums_list" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forums~_list>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| ?not_deleted_only: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.forum_info" | type Forum_types.forum_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns the list of forums
>>
<<pre id="VALget_message" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_message>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns a message
>>
<<pre id="VALget_thread" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_thread>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns a list of messages containing the message of id <<span class="odocwiki_inlinecode"|~~message~_id>>
    and all its children~, ordered according depth first traversal of the tree~.
    ~For each message~, the information retrieved is~:
    <<span class="odocwiki_inlinecode"|~(id~, subject~, author~, datetime~, parent~_id~, root~_id~, forum~_id~, wikibox~,
    moderated~, tree~_min~, tree~_max~)>>~.
    ~The list is not filtered and also contains deleted messages~.
    ~The result is ordered according to tree~_min~.
>>
<<pre id="VALget_childs" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_childs>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| message_id: >><<a_api text="Forum_types.message" | type Forum_types.message >> <<span class="ocsforge_color_delimiter"| -> >>\\  unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns a list of all the direct childs of messages <<span class="odocwiki_inlinecode"|~~message~_id>>~.
    ~The list is not filtered and also contains deleted messages~.
    ~The result is ordered according to tree~_min~.
>>
<<pre id="VALget_message_list" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_message~_list>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| forum: >><<a_api text="Forum_types.forum" | type Forum_types.forum >> <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| first: >>int64 <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| number: >>int64 <<span class="ocsforge_color_delimiter"| -> >>\\  <<span class="ocsforge_color_label"| moderated_only: >>bool <<span class="ocsforge_color_delimiter"| -> >> unit <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="Forum_types.message_info" | type Forum_types.message_info >> list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns the list of messages ~(without comments~) in a forum~.
    ~If <<span class="odocwiki_inlinecode"|moderated~_only>> is true~, will return~:
* moderated messages
* all messages with special rights ~(without looking at rights~)

>>
<<pre id="VALget_wikibox_creator" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_wikibox~_creator>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  <<span class="ocsforge_color_label"| wb: >><<a_api text="Wiki_types.wikibox" | type Wiki_types.wikibox >> <<span class="ocsforge_color_delimiter"| -> >> <<a_api text="User_sql.Types.userid" | type User_sql.Types.userid >> option <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns the creator of a wikibox containing a forum message
    or forum message title~. <<span class="odocwiki_inlinecode"|~None>> if not a forum wikibox~.
>>
<<pre id="VALwikibox_is_moderated" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|wikibox~_is~_moderated>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|<<span class="ocsforge_color_label"| wb: >><<a_api text="Wiki_types.wikibox" | type Wiki_types.wikibox >> <<span class="ocsforge_color_delimiter"| -> >> bool <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<div class="odocwiki_info"|returns whether the message has been moderated or not~.
    ~The argument is either the wikibox containing the message or the
    message title~. ~The result is <<span class="odocwiki_inlinecode"|false>> if it is not a forum wikibox~.
>>
<<pre id="VALget_forums_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forums~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  unit <<span class="ocsforge_color_delimiter"| -> >>\\  < id : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|non_nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|int32_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>;\\    title : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|string_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> >\\  list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALget_forums_wiki_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forums~_wiki~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  unit <<span class="ocsforge_color_delimiter"| -> >>\\  < id : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|non_nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|int32_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>;\\    title : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|string_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> >\\  list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>><<pre id="VALget_forum_messages_id" class="ocsforge_color odocwiki_code"|<<span class="ocsforge_color_keyword"|val>> <<span class="odocwiki_name"|get~_forum~_messages~_id>> <<span class="ocsforge_color_delimiter"|~:>> <<span class="odocwiki_type"|\\  unit <<span class="ocsforge_color_delimiter"| -> >>\\  < id : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|non_nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|int32_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>;\\    title : < get : unit; nul : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|nullable>>; t : <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|string_t>> > <<span class="ocsforge_color_uid"|Sql>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>> >\\  list <<span class="ocsforge_color_uid"|Lwt>><<span class="ocsforge_color_delimiter"| . >><<span class="ocsforge_color_lid"|t>>>>>>